@page "/Jp"
@inject IRunService RunService
@using System.Globalization

@if (quests is null || quests.Count == 0)
{
    <span>Loading Quests...</span>
}
else
{
    <TabControl>
        @foreach (Quest q in quests)
        {
            <TabPage Text=@q.JpName>
                @if (runs is null || runs.Count == 0)
                {
                    <span>Loading Runs...</span>
                }
                else
                {
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Dps</th>
                                <th>Url</th>
                                <th>Party</th>
                                <th>Cost</th>
                            </tr>
                        </thead>
                        <tbody>

                            @foreach (var run in runs.Where(r => r.Quest.Id == q.Id))
                            {
                                <tr>
                                    <td>@run.Dps.JpName</td>
                                    <td>@run.RunUrl</td>
                                    <td>@PartyToString(run.Party)</td>
                                    <td>@run.Cost</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                }
            </TabPage>
        }
    </TabControl>
}


@code {
    string party = string.Empty;
    List<Quest>? quests = null;
    List<Run>? runs = null;
    public string PartyToString(List<PartySlot> l)
    {
        string str = string.Empty;
        if (l is not null && l.Count > 0)
        {
            foreach (var ps in l)
            {
                str += ps.Servant?.JpName;
                str += ps.CraftEssence?.JpName;
                str += "\n";
            }

        }
        return str;
    }
    protected override async Task OnInitializedAsync()
    {
        party = string.Empty;
        quests = await RunService.GetQuests();
        runs = await RunService.GetRuns();
    }

}
